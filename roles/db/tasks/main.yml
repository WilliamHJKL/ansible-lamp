---
- name: install and configure mariadb
  hosts: db
  tasks:
  - name: Install mariadb
    yum:  "pkg={{ item }} state=latest"
    with_items:
      - mariadb
      - mariadb-server
      - MySQL-python
      - php-mysql

  - name: Open port
    firewalld: "port=3306/tcp state=enabled zone=public permanent=yes immediate=true"

  - name: start and enable mariadb
    service: "name=mariadb state=started enabled=yes"

  - name: Ensure the application db is present
    mysql_db:
      name: '{{ dbname }}'
      state: present

  - name: Ensure the MariaDB db is present
    mysql_user:
      name: '{{ dbuser }}'
      password: '{{ dbpass }}'
      priv: '*.*:ALL'
      host: '%'
      state: present
